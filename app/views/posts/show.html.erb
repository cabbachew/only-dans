<%= @post.body %>

<%= link_to 'Edit', edit_post_path(@post) %>

<%= link_to 'Back', posts_path %>

<h2 class="text-serif text-xl my-4">Comments</h2>

<% @post.comments.each do |comment| %>
  <p>
    <strong>Commenter:</strong>
    <%= comment.user.full_name %>
  </p>

  <p>
    <strong>Comment:</strong>
    <%= comment.body %>
  </p>

  <% if comment.user == current_user %>
    <%= link_to "Delete", comment_path(comment), data: { turbo_method: :delete, turbo_confirm: "Are you sure?" }, class: "hover:underline hover:underline-offset-4" %>
  <% end %>

  <div class="ml-8">
    <% comment.comments.each do |child| %>
      <strong>Commenter:</strong>
      <%= child.user.full_name %>

      <strong>Comment:</strong>
      <%= child.body %>

      <% if child.user == current_user %>
        <%= link_to "Delete", comment_path(child), data: { turbo_method: :delete, turbo_confirm: "Are you sure?" }, class: "ml-12 hover:underline hover:underline-offset-4" %>
      <% end %>
      <br>
    <% end %>
    
    <%= form_with model: [comment.comments.build] do |form| %>
      <%= form.text_field :body %>
      <%= form.hidden_field :commentable_id, value: comment.id %>
      <%= form.hidden_field :commentable_type, value: "Comment" %>
      <%= form.submit "Create Comment", class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" %>
    <% end %>
  </div>

  <hr class="my-4">
<% end %>

<%= form_with model: [@post.comments.build] do |form| %>
  <%= form.text_field :body %>
  <%= form.hidden_field :commentable_id, value: @post.id %>
  <%= form.hidden_field :commentable_type, value: "Post" %>
  <%= form.submit "Create Comment", class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" %>
<% end %>